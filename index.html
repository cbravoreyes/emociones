<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cuaderno HTML5: Emociones en el Aula</title>
<meta name="description" content="Cuaderno escolar en HTML5 sobre educación emocional: avatar 3D que habla, explicación y test con resultados." />
<style>
  :root{
    --bg:#0f172a;
    --panel:#111827ee;
    --ink:#e5e7eb;
    --muted:#cbd5e1;
    --brand:#22d3ee;
    --accent:#a78bfa;
    --ok:#22c55e;
    --warn:#f59e0b;
    --bad:#ef4444;
    --focus:#f472b6;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial;
    color:var(--ink); background:
      radial-gradient(1400px 700px at 10% -10%, #1e293b 0%, #0f172a 60%) fixed,
      linear-gradient(#0f172a,#0f172a);
  }
  a{color:var(--brand)}
  header{
    position:sticky; top:0; z-index:50; backdrop-filter: blur(8px);
    background: #0b1220cc; border-bottom:1px solid #1f2937;
  }
  .wrap{max-width:1100px; margin-inline:auto; padding:1rem}
  .bar{display:flex; gap:.75rem; align-items:center; justify-content:space-between}
  .brand{font-weight:800; letter-spacing:.3px}
  nav{display:flex; flex-wrap:wrap; gap:.5rem}
  nav a, .chip{
    display:inline-flex; align-items:center; gap:.5rem;
    padding:.55rem .8rem; border:1px solid #243042; border-radius:999px;
    text-decoration:none; color:var(--ink); font-size:.95rem;
  }
  nav a:hover, .chip:hover{border-color:#334155; background:#111827}
  main{padding:2rem 1rem; margin-inline:auto; max-width:1100px; display:grid; gap:2rem}
  section{
    background:var(--panel); border:1px solid #1f2937; border-radius:18px;
    padding:1.25rem; box-shadow: 0 8px 40px #00000033;
  }
  h1{font-size:clamp(1.5rem,2.2vw,2.2rem); margin:.25rem 0 0}
  h2{font-size:clamp(1.25rem,2vw,1.6rem); margin:.25rem 0 1rem}
  p{color:var(--muted); line-height:1.6}
  .grid{display:grid; gap:1rem}
  @media (min-width:900px){ .grid.cols-2{grid-template-columns:1.2fr 1fr} }
  .actions{display:flex; flex-wrap:wrap; gap:.6rem}
  button, .btn{
    background:#0b1220; border:1px solid #2a3648; color:var(--ink);
    padding:.7rem 1rem; border-radius:12px; cursor:pointer;
    transition:.2s; font-weight:600;
  }
  button:hover, .btn:hover{transform: translateY(-1px); border-color:#3b495e}
  button:focus-visible{outline:3px solid var(--focus); outline-offset:2px}
  .ok{border-color: #184a31; background:#0c1e17}
  .warn{border-color:#5a3a10; background:#1b1308}
  .bad{border-color:#5a1717; background:#1b0c0c}
  .accent{border-color:#3e2a57; background:#151022}
  .brand{color:var(--ink)}
  .kpi{display:flex; gap:1rem; flex-wrap:wrap}
  .kpi .card{
    flex:1 1 240px; border:1px dashed #2b3749; border-radius:14px; padding:1rem; background:#0c1424;
  }
  /* Autores */
  .authors{
    text-align:center; padding:1rem; background:#111827; color:var(--brand);
    font-weight:700; border-bottom:1px solid #243042;
  }
  /* Avatar 3D simulado */
  .stage{
    perspective: 900px; perspective-origin: 50% 30%;
    display:grid; place-items:center; min-height:320px;
  }
  .avatar{
    width:min(440px, 92vw); aspect-ratio: 1.4/1;
    transform-style:preserve-3d;
    transform: rotateX(6deg) rotateY(0deg);
    transition: transform .12s ease;
    filter: drop-shadow(0 30px 70px #0006);
  }
  .head{ rx:30; ry:30; fill:url(#gradHead); stroke:#0a1220; stroke-width:2; }
  .eye{ fill:#e5e7eb; }
  .pupil{ fill:#111827 }
  .mouth{ fill:#ef4444; transform-origin:400px 280px; }
  .shine{ fill:url(#gradShine); opacity:.65 }
  .badge{ fill:url(#gradBadge) }
  .avatar[aria-busy="true"] .mouth{ animation: talk .15s infinite }
  @keyframes talk{ 0%{ transform: scaleY(0.25) } 50%{ transform: scaleY(1) } 100%{ transform: scaleY(0.25) } }
  .blink{ animation: blink 5s infinite }
  @keyframes blink{ 0%,3%,100%{transform: scaleY(1)} 1%{transform: scaleY(0.1)} }

  /* Acordeones */
  details{ border:1px solid #223048; border-radius:12px; background:#0c1424; padding:.7rem .9rem; }
  details+details{margin-top:.7rem}
  summary{cursor:pointer; font-weight:700; color:var(--ink)}
  .tag{display:inline-block; font-size:.8rem; padding:.2rem .5rem; border-radius:999px; border:1px solid #314155; color:#cbd5e1}

  /* Test */
  .q{border:1px solid #1e2a3d; border-radius:12px; padding:1rem; background:#0d1526}
  .q h3{margin:.2rem 0 1rem; font-size:1rem}
  .scale{display:flex; gap:.4rem; align-items:center; flex-wrap:wrap}
  .scale label{ border:1px solid #2a3648; border-radius:10px; padding:.35rem .6rem; cursor:pointer; }
  .scale input{accent-color:var(--brand)}
  .result{ border:1px solid #243042; background:#0a1324; border-radius:16px; padding:1rem }
  progress{width:100%; height:14px}
  .footnote{font-size:.85rem; color:#9aa7bd}
  .small{font-size:.9rem}
</style>
</head>
<body>
<div class="authors">
  Autores: Mercedes Leticia Sánchez Ambriz y Carlos Bravo Reyes
</div>

<header>
  <div class="wrap bar" role="navigation" aria-label="Navegación principal">
    <div class="brand">🧠 Cuaderno HTML5 · <span class="chip">Emociones en el aula</span></div>
    <nav>
      <a href="#avatar">Avatar 3D</a>
      <a href="#que-son">¿Qué son?</a>
      <a href="#importan">¿Por qué importan?</a>
      <a href="#test">Test</a>
      <a href="#resultados">Resultados</a>
    </nav>
  </div>
</header>

<main>
  <!-- AVATAR 3D HABLANTE -->
  <section id="avatar" aria-labelledby="tit-avatar">
    <div class="grid cols-2">
      <div>
        <h1 id="tit-avatar">Avatar 3D (simulado) que te habla sobre emociones</h1>
        <p>
          Presiona <strong>“Escuchar”</strong> para oír una breve introducción. Puedes
          editar el texto si deseas que el avatar diga algo distinto. El efecto 3D se
          mueve levemente con tu cursor o tu dedo (en móviles).
        </p>
        <div class="actions" style="margin:.8rem 0">
          <button id="btnSpeak" class="accent" aria-controls="speechText">▶ Escuchar</button>
          <button id="btnStop">⏹ Detener</button>
          <button id="btnVoice">🗣 Cambiar voz</button>
          <button id="btnContrast" class="chip" aria-pressed="false">🌓 Alto contraste</button>
        </div>
        <label class="small" for="speechText">Texto a locutar:</label>
        <textarea id="speechText" rows="4" style="width:100%;border:1px solid #2a3648;border-radius:12px;background:#0b1220;color:var(--ink);padding:.7rem">
¡Hola! Soy tu guía emocional. Las emociones son señales que nos ayudan a entender lo que sentimos y a decidir qué hacer.
No son buenas o malas: todas tienen una función. En el aula, reconocerlas nos permite aprender mejor, colaborar y cuidarnos.
Hoy exploraremos cinco: alegría, tristeza, miedo, ira y sorpresa. ¿Listos?
        </textarea>
        <p class="footnote">Nota: el habla usa la API nativa del navegador (SpeechSynthesis). En algunos dispositivos debes subir el volumen o elegir otra voz.</p>
      </div>

      <div class="stage" aria-hidden="true">
        <!-- SVG con brillos para sensación 3D -->
        <svg class="avatar" viewBox="0 0 800 560" role="img" aria-label="Avatar 3D">
          <defs>
            <linearGradient id="gradHead" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#22314a"/>
              <stop offset="50%" stop-color="#152034"/>
              <stop offset="100%" stop-color="#0b1220"/>
            </linearGradient>
            <radialGradient id="gradShine" cx="30%" cy="20%" r="60%">
              <stop offset="0%" stop-color="#8ab8ff88"/>
              <stop offset="100%" stop-color="#8ab8ff00"/>
            </radialGradient>
            <linearGradient id="gradBadge" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#22d3ee"/>
              <stop offset="100%" stop-color="#a78bfa"/>
            </linearGradient>
          </defs>
          <!-- Cabeza -->
          <rect x="120" y="70" width="560" height="400" class="head" />
          <!-- Brillo -->
          <ellipse class="shine" cx="310" cy="150" rx="180" ry="120"></ellipse>
          <!-- Ojos -->
          <g transform="translate(0,0)">
            <ellipse class="eye blink" cx="305" cy="210" rx="54" ry="38"></ellipse>
            <circle class="pupil" cx="305" cy="210" r="14"></circle>
            <ellipse class="eye blink" cx="505" cy="210" rx="54" ry="38"></ellipse>
            <circle class="pupil" cx="505" cy="210" r="14"></circle>
          </g>
          <!-- Boca -->
          <g transform="translate(0,50)">
            <rect class="mouth" x="345" y="270" width="110" height="18" rx="10" ry="10"></rect>
          </g>
          <!-- Insignia -->
          <circle class="badge" cx="640" cy="380" r="22"></circle>
        </svg>
      </div>
    </div>
  </section>

  <!-- ¿QUÉ SON LAS EMOCIONES? -->
  <section id="que-son" aria-labelledby="tit-que">
    <h2 id="tit-que">¿Qué son las emociones?</h2>
    <p>
      Las <strong>emociones</strong> son respuestas psicofisiológicas que nos preparan para actuar.
      Funcionan como un sistema de alerta y significado: informan de nuestras necesidades
      y mejoran la toma de decisiones si aprendemos a reconocerlas y regularlas.
    </p>
    <div class="grid">
      <details>
        <summary>🔆 Alegría <span class="tag">energía · conexión</span></summary>
        <p>Señala logro o vínculo. Favorece la motivación y la creatividad.</p>
      </details>
      <details>
        <summary>🌧 Tristeza <span class="tag">cuidado · reflexión</span></summary>
        <p>Invita al recogimiento y a pedir apoyo. Clave para procesar pérdidas.</p>
      </details>
      <details>
        <summary>⚠️ Miedo <span class="tag">protección · prudencia</span></summary>
        <p>Activa alerta para evaluar riesgos. Se regula con información y acompañamiento.</p>
      </details>
      <details>
        <summary>🔥 Ira <span class="tag">límites · justicia</span></summary>
        <p>Señala que un límite fue cruzado. Canalizarla en diálogo asertivo evita daño.</p>
      </details>
      <details>
        <summary>✨ Sorpresa <span class="tag">curiosidad · aprendizaje</span></summary>
        <p>Abre la atención a lo nuevo. Bien enfocada, potencia la exploración.</p>
      </details>
    </div>
  </section>

  <!-- ¿POR QUÉ IMPORTAN? -->
  <section id="importan" aria-labelledby="tit-imp">
    <h2 id="tit-imp">¿Por qué importan en el aula?</h2>
    <div class="kpi">
      <div class="card">
        <strong>Clima de aula</strong>
        <p class="small">Reconocer emociones reduce conflictos y mejora la cooperación.</p>
      </div>
      <div class="card">
        <strong>Aprendizaje</strong>
        <p class="small">Regulación emocional → mayor atención, memoria y creatividad.</p>
      </div>
      <div class="card">
        <strong>Bienestar</strong>
        <p class="small">Habilidades socioemocionales protegen frente a estrés académico.</p>
      </div>
      <div class="card">
        <strong>Ciudadanía</strong>
        <p class="small">Empatía y autocuidado fortalecen la convivencia democrática.</p>
      </div>
    </div>
  </section>

  <!-- TEST -->
  <section id="test" aria-labelledby="tit-test">
    <h2 id="tit-test">Test de alfabetización emocional (10 ítems)</h2>
    <p>Marca de 1 a 5 según qué tan cierto es para ti (1 = nada cierto, 5 = muy cierto).</p>
    <div class="grid">
      <div class="q">
        <h3>1) Identifico con facilidad lo que siento.</h3>
        <div class="scale" data-key="autoconciencia">
          <label><input type="radio" name="q1" value="1">1</label>
          <label><input type="radio" name="q1" value="2">2</label>
          <label><input type="radio" name="q1" value="3">3</label>
          <label><input type="radio" name="q1" value="4">4</label>
          <label><input type="radio" name="q1" value="5">5</label>
        </div>
      </div>
      <div class="q">
        <h3>2) Sé regular mi emoción antes de responder.</h3>
        <div class="scale" data-key="autorregulacion">
          <label><input type="radio" name="q2" value="1">1</label>
          <label><input type="radio" name="q2" value="2">2</label>
          <label><input type="radio" name="q2" value="3">3</label>
          <label><input type="radio" name="q2" value="4">4</label>
          <label><input type="radio" name="q2" value="5">5</label>
        </div>
      </div>
      <div class="q">
        <h3>3) Puedo nombrar la emoción que percibo en otros.</h3>
        <div class="scale" data-key="empatia">
          <label><input type="radio" name="q3" value="1">1</label>
          <label><input type="radio" name="q3" value="2">2</label>
          <label><input type="radio" name="q3" value="3">3</label>
          <label><input type="radio" name="q3" value="4">4</label>
          <label><input type="radio" name="q3" value="5">5</label>
        </div>
      </div>
      <div class="q">
        <h3>4) Expreso mis emociones con respeto.</h3>
        <div class="scale" data-key="habilidades_sociales">
          <label><input type="radio" name="q4" value="1">1</label>
          <label><input type="radio" name="q4" value="2">2</label>
          <label><input type="radio" name="q4" value="3">3</label>
          <label><input type="radio" name="q4" value="4">4</label>
          <label><input type="radio" name="q4" value="5">5</label>
        </div>
      </div>
      <div class="q">
        <h3>5) Identifico señales físicas cuando una emoción aparece.</h3>
        <div class="scale" data-key="autoconciencia">
          <label><input type="radio" name="q5" value="1">1</label>
          <label><input type="radio" name="q5" value="2">2</label>
          <label><input type="radio" name="q5" value="3">3</label>
          <label><input type="radio" name="q5" value="4">4</label>
          <label><input type="radio" name="q5" value="5">5</label>
        </div>
      </div>
      <div class="q">
        <h3>6) Uso estrategias (respirar, pausar, moverse) para calmarme.</h3>
        <div class="scale" data-key="autorregulacion">
          <label><input type="radio" name="q6" value="1">1</label>
          <label><input type="radio" name="q6" value="2">2</label>
          <label><input type="radio" name="q6" value="3">3</label>
          <label><input type="radio" name="q6" value="4">4</label>
          <label><input type="radio" name="q6" value="5">5</label>
        </div>
      </div>
      <div class="q">
        <h3>7) Escucho activamente cuando alguien expresa una emoción.</h3>
        <div class="scale" data-key="empatia">
          <label><input type="radio" name="q7" value="1">1</label>
          <label><input type="radio" name="q7" value="2">2</label>
          <label><input type="radio" name="q7" value="3">3</label>
          <label><input type="radio" name="q7" value="4">4</label>
          <label><input type="radio" name="q7" value="5">5</label>
        </div>
      </div>
      <div class="q">
        <h3>8) Resuelvo conflictos sin descalificar a nadie.</h3>
        <div class="scale" data-key="habilidades_sociales">
          <label><input type="radio" name="q8" value="1">1</label>
          <label><input type="radio" name="q8" value="2">2</label>
          <label><input type="radio" name="q8" value="3">3</label>
          <label><input type="radio" name="q8" value="4">4</label>
          <label><input type="radio" name="q8" value="5">5</label>
        </div>
      </div>
      <div class="q">
        <h3>9) Cuando me equivoco, reparo el daño y aprendo.</h3>
        <div class="scale" data-key="autorregulacion">
          <label><input type="radio" name="q9" value="1">1</label>
          <label><input type="radio" name="q9" value="2">2</label>
          <label><input type="radio" name="q9" value="3">3</label>
          <label><input type="radio" name="q9" value="4">4</label>
          <label><input type="radio" name="q9" value="5">5</label>
        </div>
      </div>
      <div class="q">
        <h3>10) Pido apoyo cuando lo necesito.</h3>
        <div class="scale" data-key="habilidades_sociales">
          <label><input type="radio" name="q10" value="1">1</label>
          <label><input type="radio" name="q10" value="2">2</label>
          <label><input type="radio" name="q10" value="3">3</label>
          <label><input type="radio" name="q10" value="4">4</label>
          <label><input type="radio" name="q10" value="5">5</label>
        </div>
      </div>
    </div>

    <div class="actions" style="margin-top:1rem">
      <button id="btnCalcular" class="ok">✅ Calcular resultados</button>
      <button id="btnLimpiar" class="warn">↺ Reiniciar</button>
      <button id="btnDescargar" class="accent">⬇ Descargar resultados</button>
      <button id="btnImprimir" class="chip">🖨 Imprimir / PDF</button>
    </div>
  </section>

  <!-- RESULTADOS -->
  <section id="resultados" aria-labelledby="tit-res">
    <h2 id="tit-res">Resultados y recomendaciones</h2>
    <div class="result" role="status" aria-live="polite">
      <p id="resResumen">Resuelve el test y aquí verás tu resumen.</p>
      <div id="resBarras" style="display:none; margin:1rem 0">
        <div class="small">Autoconciencia</div>
        <progress id="barAutoCon" max="5" value="0"></progress>
        <div class="small">Autorregulación</div>
        <progress id="barAutoReg" max="5" value="0"></progress>
        <div class="small">Empatía</div>
        <progress id="barEmpatia" max="5" value="0"></progress>
        <div class="small">Habilidades sociales</div>
        <progress id="barHabs" max="5" value="0"></progress>
      </div>
      <div id="resDetalle"></div>
    </div>
    <p class="footnote">Este test es orientativo; no sustituye evaluación clínica. Úsalo para reflexionar y planificar acciones en el aula.</p>
  </section>
</main>

<script>
/* ======== Alto contraste ======== */
document.getElementById('btnContrast').addEventListener('click', (e)=>{
  const pressed = e.currentTarget.getAttribute('aria-pressed') === 'true';
  e.currentTarget.setAttribute('aria-pressed', String(!pressed));
  if(!pressed){
    document.documentElement.style.setProperty('--bg','#000');
    document.documentElement.style.setProperty('--panel','#000');
    document.documentElement.style.setProperty('--ink','#fff');
    document.documentElement.style.setProperty('--muted','#ddd');
  }else{
    document.documentElement.style.setProperty('--bg','#0f172a');
    document.documentElement.style.setProperty('--panel','#111827ee');
    document.documentElement.style.setProperty('--ink','#e5e7eb');
    document.documentElement.style.setProperty('--muted','#cbd5e1');
  }
});

/* ======== Avatar 3D simulado: movimiento y habla ======== */
const svg = document.querySelector('.avatar');
const mouth = svg.querySelector('.mouth');
let talking = false;
let currentVoiceIndex = 0;

function tilt(e){
  const rect = svg.getBoundingClientRect();
  const x = (e.clientX ?? (e.touches?.[0]?.clientX||rect.left)) - rect.left;
  const y = (e.clientY ?? (e.touches?.[0]?.clientY||rect.top)) - rect.top;
  const px = (x/rect.width - .5) * 18;
  const py = (y/rect.height - .5) * -10;
  svg.style.transform = `rotateX(${py}deg) rotateY(${px}deg)`;
}
svg.addEventListener('mousemove', tilt, {passive:true});
svg.addEventListener('touchmove', tilt, {passive:true});
svg.addEventListener('mouseleave', ()=> svg.style.transform='rotateX(6deg) rotateY(0deg)');

function startMouth(){
  if(talking) return;
  talking = true;
  svg.setAttribute('aria-busy','true');
}
function stopMouth(){
  talking = false;
  svg.removeAttribute('aria-busy');
}

function getVoicesEs(){
  const all = speechSynthesis.getVoices();
  const es = all.filter(v=>/es-|Spanish|español/i.test(v.lang+v.name));
  return es.length? es : all;
}
function speakText(text){
  if(!('speechSynthesis' in window)) { alert('Tu navegador no soporta SpeechSynthesis.'); return; }
  speechSynthesis.cancel();
  const voices = getVoicesEs();
  const utter = new SpeechSynthesisUtterance(text);
  if(voices.length){
    utter.voice = voices[Math.min(currentVoiceIndex, voices.length-1)];
  }
  utter.rate = 1.02; utter.pitch = 1.0; utter.volume = 1.0;
  utter.onstart = startMouth;
  utter.onend = stopMouth;
  speechSynthesis.speak(utter);
}
document.getElementById('btnSpeak').addEventListener('click', ()=>{
  const t = document.getElementById('speechText').value.trim();
  if(!t) return;
  if(speechSynthesis.speaking){ speechSynthesis.cancel(); stopMouth(); }
  const ensure = ()=> speakText(t);
  if(speechSynthesis.getVoices().length) ensure(); else speechSynthesis.onvoiceschanged = ensure;
});
document.getElementById('btnStop').addEventListener('click', ()=>{
  speechSynthesis.cancel(); stopMouth();
});
document.getElementById('btnVoice').addEventListener('click', ()=>{
  const voices = getVoicesEs();
  if(!voices.length) return;
  currentVoiceIndex = (currentVoiceIndex+1) % voices.length;
  const name = voices[currentVoiceIndex].name || voices[currentVoiceIndex].lang;
  alert('Voz seleccionada: ' + name);
});

/* ======== Test: cálculo y reporte ======== */
const dominios = ['autoconciencia','autorregulacion','empatia','habilidades_sociales'];

function calcular(){
  const valores = {};
  dominios.forEach(d=> valores[d] = []);
  document.querySelectorAll('.scale').forEach(s=>{
    const key = s.dataset.key;
    const checked = s.querySelector('input:checked');
    if(checked) valores[key].push(Number(checked.value));
  });

  let respondidas = 0, sumaTotal = 0, totalItems = 0;
  const resumen = {};
  for(const k of dominios){
    const arr = valores[k];
    if(arr.length){
      const avg = arr.reduce((a,b)=>a+b,0)/arr.length;
      resumen[k] = Number(avg.toFixed(2));
      respondidas += arr.length;
      sumaTotal += arr.reduce((a,b)=>a+b,0);
      totalItems += arr.length;
    }else{
      resumen[k] = 0;
    }
  }
  if(respondidas < 10){
    alert('Por favor responde las 10 preguntas para ver resultados.');
    return null;
  }
  const promedio = Number((sumaTotal/totalItems).toFixed(2));
  return {resumen, promedio};
}

function consejo(n){
  if(n >= 4.0) return {txt:'Muy buen nivel. Mantén prácticas de cuidado, escucha activa y estrategias de regulación.', badge:'✅', cls:'ok'};
  if(n >= 3.0) return {txt:'Nivel adecuado. Refuerza con respiración, diarios emocionales y acuerdos de convivencia.', badge:'🟡', cls:'warn'};
  return {txt:'Necesitas refuerzo. Practica pausa consciente, pedir ayuda y entrenamiento en habilidades sociales.', badge:'❗', cls:'bad'};
}

document.getElementById('btnCalcular').addEventListener('click', ()=>{
  const out = calcular(); if(!out) return;
  const {resumen, promedio} = out;

  document.getElementById('resBarras').style.display='block';
  document.getElementById('barAutoCon').value = resumen.autoconciencia;
  document.getElementById('barAutoReg').value = resumen.autorregulacion;
  document.getElementById('barEmpatia').value = resumen.empatia;
  document.getElementById('barHabs').value = resumen.habilidades_sociales;

  const c = consejo(promedio);
  const resResumen = document.getElementById('resResumen');
  resResumen.innerHTML = `<strong>Promedio global:</strong> ${promedio} / 5 · <span class="${c.cls} chip">${c.badge} ${c.txt}</span>`;

  const det = document.getElementById('resDetalle');
  det.innerHTML = `
    <ul>
      <li><strong>Autoconciencia:</strong> ${resumen.autoconciencia}</li>
      <li><strong>Autorregulación:</strong> ${resumen.autorregulacion}</li>
      <li><strong>Empatía:</strong> ${resumen.empatia}</li>
      <li><strong>Habilidades sociales:</strong> ${resumen.habilidades_sociales}</li>
    </ul>
    <p class="small"><em>Ideas de mejora rápida</em>: 4-7-8 respiración · Diario emocional (3 minutos) · “Pausa antes de enviar” · Agradecimiento breve al cierre de clase · Acordar lenguaje respetuoso para disentir.</p>
  `;

  window.__lastReport = {fecha: new Date().toLocaleString(), ...resumen, promedio};
});

document.getElementById('btnLimpiar').addEventListener('click', ()=>{
  document.querySelectorAll('.scale input:checked').forEach(el=> el.checked=false);
  document.getElementById('resBarras').style.display='none';
  document.getElementById('resResumen').textContent='Resuelve el test y aquí verás tu resumen.';
  document.getElementById('resDetalle').textContent='';
  window.__lastReport = null;
  window.scrollTo({top:0, behavior:'smooth'});
});

document.getElementById('btnDescargar').addEventListener('click', ()=>{
  const data = window.__lastReport;
  if(!data){ alert('Calcula tus resultados primero.'); return; }
  const texto = `Resultados — Test de alfabetización emocional
Fecha: ${data.fecha}
Autoconciencia: ${data.autoconciencia}
Autorregulación: ${data.autorregulacion}
Empatía: ${data.empatia}
Habilidades sociales: ${data.habilidades_sociales}
Promedio global: ${data.promedio} / 5
`;
  const blob = new Blob([texto], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'resultado-emociones.txt';
  a.click();
  setTimeout(()=> URL.revokeObjectURL(url), 1000);
});

document.getElementById('btnImprimir').addEventListener('click', ()=> window.print());
</script>
</body>
</html>
